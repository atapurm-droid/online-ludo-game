<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù…Ù†Ú† Ø¢Ù†Ù„Ø§ÛŒÙ†</title>
    <style>
        /* Ø§Ø³ØªØ§ÛŒÙ„â€ŒÙ‡Ø§ÛŒ Ù‚Ø¨Ù„ÛŒ + Ø§Ø¶Ø§ÙØ§Øª Ø¬Ø¯ÛŒØ¯ */
        
        .waiting-room {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            text-align: center;
            margin-bottom: 20px;
            max-width: 400px;
        }
        
        .player-list {
            margin: 20px 0;
            padding: 15px;
            background: #f9f9f9;
            border-radius: 10px;
            min-height: 100px;
        }
        
        .player-item {
            padding: 8px;
            margin: 5px 0;
            background: #e3f2fd;
            border-radius: 8px;
            border-right: 4px solid #2196f3;
        }
        
        .ready-btn {
            background: linear-gradient(145deg, #4caf50, #2e7d32);
            color: white;
            padding: 12px 30px;
            font-size: 1.1rem;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            margin: 10px;
        }
    </style>
</head>
<body>

<!-- Ø§ØªØ§Ù‚ Ø§Ù†ØªØ¸Ø§Ø± -->
<div id="waitingRoom" class="waiting-room">
    <h2>ğŸ® Ø§ØªØ§Ù‚ Ø§Ù†ØªØ¸Ø§Ø± Ù…Ù†Ú† Ø¢Ù†Ù„Ø§ÛŒÙ†</h2>
    <div class="player-list" id="playerList">
        <p>Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø± Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†...</p>
    </div>
    <div id="waitingInfo">
        <p>Ù…ÙˆÙ‚Ø¹ÛŒØª Ø´Ù…Ø§ Ø¯Ø± ØµÙ: <span id="position">-</span></p>
    </div>
    <button class="ready-btn" onclick="joinWaitingRoom()">Ø¢Ù…Ø§Ø¯Ù‡ Ø¨Ø§Ø²ÛŒ Ù‡Ø³ØªÙ…! âœ…</button>
</div>

<!-- Ø¨Ø§Ø²ÛŒ Ø§ØµÙ„ÛŒ (Ù…Ø®ÙÛŒ Ø¯Ø± Ø§Ø¨ØªØ¯Ø§) -->
<div id="gameContainer" class="game-container" style="display: none;">
    <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø¨Ø§Ø²ÛŒ Ù‚Ø¨Ù„ÛŒ -->
    <div class="timer-box" id="timer-display">â±ï¸ 40</div>
    <div class="turn-info" id="turn-text">Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ...</div>
    
    <div class="dice-container">
        <div class="dice-face" id="dice-visual"></div>
    </div>

    <button id="roll-btn" onclick="rollDice()">ØªØ§Ø³ Ø¨Ø±ÛŒØ²</button>
    
    <div class="board" id="board">
        <!-- Ù…Ø­ØªÙˆØ§ÛŒ Ø¨ÙˆØ±Ø¯ Ø¨Ø§Ø²ÛŒ -->
    </div>
    
    <div id="onlinePlayers"></div>
    <p id="msg" style="font-size:0.95rem; color:#555; margin-top:10px;">Ø§ØªØµØ§Ù„...</p>
</div>

<script src="/socket.io/socket.io.js"></script>
<script>
    // Ù…ØªØºÛŒØ±Ù‡Ø§ÛŒ Ú¯Ù„ÙˆØ¨Ø§Ù„
    let socket = null;
    let currentRoom = null;
    let myColor = null;

    // Ø§ØªØµØ§Ù„ Ø¨Ù‡ Ø³Ø±ÙˆØ±
    function connectToServer() {
        socket = io();
        
        socket.on('connect', () => {
            console.log('Ù…ØªØµÙ„ Ø´Ø¯ Ø¨Ù‡ Ø³Ø±ÙˆØ±');
            document.getElementById('msg').innerText = 'Ù…ØªØµÙ„ Ø¨Ù‡ Ø³Ø±ÙˆØ±';
        });
        
        socket.on('waiting-status', (data) => {
            document.getElementById('position').textContent = data.position;
            updateWaitingList(data.players);
        });
        
        socket.on('game-start', (data) => {
            startOnlineGame(data);
        });
        
        socket.on('disconnect', () => {
            document.getElementById('msg').innerText = 'Ø§ØªØµØ§Ù„ Ù‚Ø·Ø¹ Ø´Ø¯';
        });
    }

    function joinWaitingRoom() {
        if (!socket) connectToServer();
        
        const playerName = prompt('Ù†Ø§Ù… Ø®ÙˆØ¯ Ø±Ø§ ÙˆØ§Ø±Ø¯ Ú©Ù†ÛŒØ¯:', `Ø¨Ø§Ø²ÛŒÚ©Ù†${Math.floor(Math.random() * 1000)}`);
        socket.emit('join-waiting', { name: playerName || 'Ø¨Ø§Ø²ÛŒÚ©Ù† Ù†Ø§Ø´Ù†Ø§Ø³' });
        
        document.querySelector('.ready-btn').disabled = true;
        document.querySelector('.ready-btn').textContent = 'Ø¯Ø± Ø§Ù†ØªØ¸Ø§Ø±... â³';
    }

    function updateWaitingList(players) {
        const list = document.getElementById('playerList');
        list.innerHTML = '<h3>Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø­Ø§Ø¶Ø±:</h3>';
        
        players.forEach((player, index) => {
            const div = document.createElement('div');
            div.className = 'player-item';
            div.textContent = `${index + 1}. ${player.playerName}`;
            list.appendChild(div);
        });
    }

    function startOnlineGame(gameData) {
        currentRoom = gameData.roomId;
        myColor = gameData.yourColor;
        
        // Ù…Ø®ÙÛŒ Ú©Ø±Ø¯Ù† Ø§ØªØ§Ù‚ Ø§Ù†ØªØ¸Ø§Ø± Ùˆ Ù†Ù…Ø§ÛŒØ´ Ø¨Ø§Ø²ÛŒ
        document.getElementById('waitingRoom').style.display = 'none';
        document.getElementById('gameContainer').style.display = 'block';
        
        // Ù†Ù…Ø§ÛŒØ´ Ø§Ø·Ù„Ø§Ø¹Ø§Øª Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù†
        updateOnlinePlayers(gameData.players);
        
        // Ø´Ø±ÙˆØ¹ Ø¨Ø§Ø²ÛŒ
        initializeGame();
        
        document.getElementById('msg').innerText = `Ø´Ù…Ø§ ${myColor} Ù‡Ø³ØªÛŒØ¯. Ø¨Ø§Ø²ÛŒ Ø´Ø±ÙˆØ¹ Ø´Ø¯!`;
    }

    function updateOnlinePlayers(players) {
        const container = document.getElementById('onlinePlayers');
        container.innerHTML = '<h3>Ø¨Ø§Ø²ÛŒÚ©Ù†Ø§Ù† Ø¢Ù†Ù„Ø§ÛŒÙ†:</h3>';
        
        players.forEach(player => {
            const div = document.createElement('div');
            div.className = 'player-item';
            div.style.borderRightColor = `var(--${player.color})`;
            div.textContent = `${player.playerName} (${player.color})`;
            if (player.color === myColor) {
                div.style.background = '#e8f5e8';
                div.textContent += ' ğŸ‘ˆ Ø´Ù…Ø§';
            }
            container.appendChild(div);
        });
    }

    // ØªÙˆØ§Ø¨Ø¹ Ø¨Ø§Ø²ÛŒ (Ù‡Ù…Ø§Ù†Ù†Ø¯ Ù‚Ø¨Ù„) Ø¨Ø§ Ø§Ø¶Ø§ÙÙ‡ Ú©Ø±Ø¯Ù† socket.emit Ø¨Ø±Ø§ÛŒ Ø­Ø±Ú©Ø§Øª
    function rollDice() {
        // Ø§Ø±Ø³Ø§Ù„ Ø­Ø±Ú©Øª Ø¨Ù‡ Ø³Ø±ÙˆØ±
        socket.emit('player-action', {
            roomId: currentRoom,
            action: 'roll-dice',
            playerColor: myColor
        });
    }

    function handleTokenClick(color, id) {
        if (color !== myColor) return;
        
        socket.emit('player-action', {
            roomId: currentRoom,
            action: 'move-token',
            playerColor: myColor,
            tokenId: id
        });
    }

    // Ø§ØªØµØ§Ù„ Ø§ÙˆÙ„ÛŒÙ‡
    window.onload = function() {
        // Ù†Ù…Ø§ÛŒØ´ Ø§ØªØ§Ù‚ Ø§Ù†ØªØ¸Ø§Ø±
        document.getElementById('waitingRoom').style.display = 'block';
        document.getElementById('gameContainer').style.display = 'none';
    };
</script>

<!-- Ø¨Ù‚ÛŒÙ‡ Ø§Ø³Ú©Ø±ÛŒÙ¾Øªâ€ŒÙ‡Ø§ÛŒ Ø¨Ø§Ø²ÛŒ -->
<script>
// ØªÙˆØ§Ø¨Ø¹ Ø¨Ø§Ø²ÛŒ Ø§ØµÙ„ÛŒ (Ù‡Ù…Ø§Ù†Ù†Ø¯ ÙØ§ÛŒÙ„ Ù‚Ø¨Ù„ÛŒ)
// createBoard, initTokens, rollDice, etc.
</script>

</body>
</html>
